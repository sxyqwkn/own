Sub MergeVerticalCellsContent()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets("Sheet1") ' 根据您的工作表名称进行修改

    Dim cell As Range
    Dim mergeArea As Range
    Dim firstRow As Long, lastRow As Long, col As Long
    Dim i As Long, j As Long
    Dim mergedContent() As String
    Dim colCount As Long

    Application.ScreenUpdating = False

    ' 清空所有内容为 "-" 的单元格
    For Each cell In ws.UsedRange
        If cell.Value = "-" Then
            cell.ClearContents
        End If
    Next cell

    ' 获取工作表的列数
    colCount = ws.UsedRange.Columns.Count
    ReDim mergedContent(1 To colCount)

    For Each cell In ws.UsedRange
        ' 检查单元格是否是纵向合并的一部分
        If cell.MergeCells And cell.MergeArea.Rows.Count > 1 Then
            Set mergeArea = cell.MergeArea
            firstRow = mergeArea.Row
            lastRow = firstRow + mergeArea.Rows.Count - 1

            ' 初始化合并内容数组
            For j = 1 To colCount
                mergedContent(j) = ""
            Next j

            ' 合并每一列的内容
            For i = firstRow To lastRow
                For j = 1 To colCount
                    If ws.Cells(i, j).Value <> "" Then
                        If mergedContent(j) <> "" Then
                            mergedContent(j) = mergedContent(j) & vbCrLf
                        End If
                        mergedContent(j) = mergedContent(j) & ws.Cells(i, j).Value
                    End If
                Next j
            Next i

            ' 更新第一行的内容并取消合并
            For j = 1 To colCount
                ws.Cells(firstRow, j).Value = mergedContent(j)
            Next j
            mergeArea.UnMerge

            ' 删除多余的行
            ws.Rows(firstRow + 1 & ":" & lastRow).Delete Shift:=xlUp
        End If
    Next cell

    ' 替换所有单元格中的 "a" 为 "b"
    For Each cell In ws.UsedRange
        If InStr(cell.Value, "a") > 0 Then
            cell.Value = Replace(cell.Value, "a", "b")
        End If
    Next cell

    Application.ScreenUpdating = True
End Sub
